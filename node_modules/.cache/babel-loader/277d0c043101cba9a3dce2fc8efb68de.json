{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { mergeProps } from '../../utils/with-default-props';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useLockFn, useMemoizedFn } from 'ahooks';\nimport { withNativeProps } from '../../utils/native-props';\nimport { getScrollParent } from '../../utils/get-scroll-parent';\nimport { useConfig } from '../config-provider';\nimport DotLoading from '../dot-loading';\n\nfunction isWindow(element) {\n  return element === window;\n}\n\nconst classPrefix = `adm-infinite-scroll`;\n\nconst InfiniteScrollContent = _ref => {\n  let {\n    hasMore\n  } = _ref;\n  const {\n    locale\n  } = useConfig();\n  return React.createElement(React.Fragment, null, hasMore ? React.createElement(React.Fragment, null, React.createElement(\"span\", null, locale.common.loading), React.createElement(DotLoading, null)) : React.createElement(\"span\", null, locale.InfiniteScroll.noMore));\n};\n\nexport const InfiniteScroll = p => {\n  const props = mergeProps({\n    threshold: 250\n  }, p);\n  const doLoadMore = useLockFn(() => props.loadMore());\n  const elementRef = useRef(null); // Prevent duplicated trigger of `check` function\n\n  const [flag, setFlag] = useState({});\n  const nextFlagRef = useRef(flag);\n  const [scrollParent, setScrollParent] = useState();\n  const check = useMemoizedFn(() => __awaiter(void 0, void 0, void 0, function* () {\n    if (nextFlagRef.current !== flag) return;\n    if (!props.hasMore) return;\n    const element = elementRef.current;\n    if (!element) return;\n    if (!element.offsetParent) return;\n    const parent = getScrollParent(element);\n    setScrollParent(parent);\n    if (!parent) return;\n    const rect = element.getBoundingClientRect();\n    const elementTop = rect.top;\n    const current = isWindow(parent) ? window.innerHeight : parent.getBoundingClientRect().bottom;\n\n    if (current >= elementTop - props.threshold) {\n      const nextFlag = {};\n      nextFlagRef.current = nextFlag;\n      yield doLoadMore();\n      setFlag(nextFlag);\n    }\n  })); // 确保在内容不足时会自动触发加载事件\n\n  useEffect(() => {\n    check();\n  });\n  useEffect(() => {\n    const element = elementRef.current;\n    if (!element) return;\n    if (!scrollParent) return;\n\n    function onScroll() {\n      check();\n    }\n\n    scrollParent.addEventListener('scroll', onScroll);\n    return () => {\n      scrollParent.removeEventListener('scroll', onScroll);\n    };\n  }, [scrollParent]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix,\n    ref: elementRef\n  }, props.children && props.children, !props.children && React.createElement(InfiniteScrollContent, {\n    hasMore: props.hasMore\n  })));\n};","map":{"version":3,"names":["__awaiter","mergeProps","React","useEffect","useRef","useState","useLockFn","useMemoizedFn","withNativeProps","getScrollParent","useConfig","DotLoading","isWindow","element","window","classPrefix","InfiniteScrollContent","hasMore","locale","createElement","Fragment","common","loading","InfiniteScroll","noMore","p","props","threshold","doLoadMore","loadMore","elementRef","flag","setFlag","nextFlagRef","scrollParent","setScrollParent","check","current","offsetParent","parent","rect","getBoundingClientRect","elementTop","top","innerHeight","bottom","nextFlag","onScroll","addEventListener","removeEventListener","className","ref","children"],"sources":["/Users/yinyahui/Desktop/weblearn/juejin/react-antd-manage/react-antd-manage/node_modules/_antd-mobile@5.12.6@antd-mobile/es/components/infinite-scroll/infinite-scroll.js"],"sourcesContent":["import { __awaiter } from \"tslib\";\nimport { mergeProps } from '../../utils/with-default-props';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useLockFn, useMemoizedFn } from 'ahooks';\nimport { withNativeProps } from '../../utils/native-props';\nimport { getScrollParent } from '../../utils/get-scroll-parent';\nimport { useConfig } from '../config-provider';\nimport DotLoading from '../dot-loading';\n\nfunction isWindow(element) {\n  return element === window;\n}\n\nconst classPrefix = `adm-infinite-scroll`;\n\nconst InfiniteScrollContent = ({\n  hasMore\n}) => {\n  const {\n    locale\n  } = useConfig();\n  return React.createElement(React.Fragment, null, hasMore ? React.createElement(React.Fragment, null, React.createElement(\"span\", null, locale.common.loading), React.createElement(DotLoading, null)) : React.createElement(\"span\", null, locale.InfiniteScroll.noMore));\n};\n\nexport const InfiniteScroll = p => {\n  const props = mergeProps({\n    threshold: 250\n  }, p);\n  const doLoadMore = useLockFn(() => props.loadMore());\n  const elementRef = useRef(null); // Prevent duplicated trigger of `check` function\n\n  const [flag, setFlag] = useState({});\n  const nextFlagRef = useRef(flag);\n  const [scrollParent, setScrollParent] = useState();\n  const check = useMemoizedFn(() => __awaiter(void 0, void 0, void 0, function* () {\n    if (nextFlagRef.current !== flag) return;\n    if (!props.hasMore) return;\n    const element = elementRef.current;\n    if (!element) return;\n    if (!element.offsetParent) return;\n    const parent = getScrollParent(element);\n    setScrollParent(parent);\n    if (!parent) return;\n    const rect = element.getBoundingClientRect();\n    const elementTop = rect.top;\n    const current = isWindow(parent) ? window.innerHeight : parent.getBoundingClientRect().bottom;\n\n    if (current >= elementTop - props.threshold) {\n      const nextFlag = {};\n      nextFlagRef.current = nextFlag;\n      yield doLoadMore();\n      setFlag(nextFlag);\n    }\n  })); // 确保在内容不足时会自动触发加载事件\n\n  useEffect(() => {\n    check();\n  });\n  useEffect(() => {\n    const element = elementRef.current;\n    if (!element) return;\n    if (!scrollParent) return;\n\n    function onScroll() {\n      check();\n    }\n\n    scrollParent.addEventListener('scroll', onScroll);\n    return () => {\n      scrollParent.removeEventListener('scroll', onScroll);\n    };\n  }, [scrollParent]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix,\n    ref: elementRef\n  }, props.children && props.children, !props.children && React.createElement(InfiniteScrollContent, {\n    hasMore: props.hasMore\n  })));\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}