{"ast":null,"code":"import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from 'react';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { withNativeProps } from '../../utils/native-props';\nimport classNames from 'classnames';\nimport { bound } from '../../utils/bound';\nimport { usePropsValue } from '../../utils/use-props-value';\nconst classPrefix = 'adm-passcode-input';\nconst defaultProps = {\n  defaultValue: '',\n  length: 6,\n  plain: false,\n  error: false,\n  seperated: false,\n  caret: true\n};\nexport const PasscodeInput = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p); // 防止 length 值不合法\n\n  const cellLength = props.length > 0 && props.length < Infinity ? Math.floor(props.length) : defaultProps.length;\n  const [focused, setFocused] = useState(false);\n  const [value, setValue] = usePropsValue(props);\n  const rootRef = useRef(null);\n  const nativeInputRef = useRef(null);\n  useEffect(() => {\n    var _a;\n\n    if (value.length >= cellLength) {\n      (_a = props.onFill) === null || _a === void 0 ? void 0 : _a.call(props, value);\n    }\n  }, [value, cellLength]);\n\n  const onFocus = () => {\n    var _a, _b;\n\n    if (!props.keyboard) {\n      (_a = nativeInputRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n    }\n\n    setFocused(true);\n    (_b = props.onFocus) === null || _b === void 0 ? void 0 : _b.call(props);\n  };\n\n  useEffect(() => {\n    if (!focused) return;\n    const timeout = window.setTimeout(() => {\n      var _a;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.scrollIntoView({\n        block: 'center',\n        inline: 'center',\n        behavior: 'smooth'\n      });\n    }, 100);\n    return () => {\n      window.clearTimeout(timeout);\n    };\n  }, [focused]);\n\n  const onBlur = () => {\n    var _a;\n\n    setFocused(false);\n    (_a = props.onBlur) === null || _a === void 0 ? void 0 : _a.call(props);\n  };\n\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      var _a;\n\n      return (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n    },\n    blur: () => {\n      var _a, _b;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.blur();\n      (_b = nativeInputRef.current) === null || _b === void 0 ? void 0 : _b.blur();\n    }\n  }));\n\n  const renderCells = () => {\n    const cells = [];\n    const chars = value.split('');\n    const caretIndex = chars.length; // 光标位置index等于当前文字长度\n\n    const focusedIndex = bound(chars.length, 0, cellLength - 1);\n\n    for (let i = 0; i < cellLength; i++) {\n      cells.push(React.createElement(\"div\", {\n        className: classNames(`${classPrefix}-cell`, {\n          caret: props.caret && caretIndex === i && focused,\n          focused: focusedIndex === i && focused,\n          dot: !props.plain && chars[i]\n        }),\n        key: i\n      }, chars[i] && props.plain ? chars[i] : ''));\n    }\n\n    return cells;\n  };\n\n  const cls = classNames(classPrefix, {\n    focused: focused,\n    error: props.error,\n    seperated: props.seperated\n  });\n  return React.createElement(React.Fragment, null, withNativeProps(props, React.createElement(\"div\", {\n    ref: rootRef,\n    tabIndex: 0,\n    className: cls,\n    onFocus: onFocus,\n    onBlur: onBlur\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-cell-container`\n  }, renderCells()), React.createElement(\"input\", {\n    ref: nativeInputRef,\n    className: `${classPrefix}-native-input`,\n    value: value,\n    type: 'text',\n    pattern: '[0-9]*',\n    inputMode: 'numeric',\n    onChange: e => {\n      setValue(e.target.value.slice(0, props.length));\n    }\n  }))), props.keyboard && React.cloneElement(props.keyboard, {\n    visible: focused,\n    onInput: v => {\n      if (value.length < cellLength) {\n        setValue((value + v).slice(0, props.length));\n      }\n    },\n    onDelete: () => {\n      setValue(value.slice(0, -1));\n    },\n    onClose: () => {\n      var _a;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.blur();\n    }\n  }));\n});","map":{"version":3,"names":["React","useState","useEffect","useRef","forwardRef","useImperativeHandle","mergeProps","withNativeProps","classNames","bound","usePropsValue","classPrefix","defaultProps","defaultValue","length","plain","error","seperated","caret","PasscodeInput","p","ref","props","cellLength","Infinity","Math","floor","focused","setFocused","value","setValue","rootRef","nativeInputRef","_a","onFill","call","onFocus","_b","keyboard","current","focus","timeout","window","setTimeout","scrollIntoView","block","inline","behavior","clearTimeout","onBlur","blur","renderCells","cells","chars","split","caretIndex","focusedIndex","i","push","createElement","className","dot","key","cls","Fragment","tabIndex","type","pattern","inputMode","onChange","e","target","slice","cloneElement","visible","onInput","v","onDelete","onClose"],"sources":["/Users/yinyahui/Desktop/weblearn/juejin/react-antd-manage/react-antd-manage/node_modules/_antd-mobile@5.12.6@antd-mobile/es/components/passcode-input/passcode-input.js"],"sourcesContent":["import React, { useState, useEffect, useRef, forwardRef, useImperativeHandle } from 'react';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { withNativeProps } from '../../utils/native-props';\nimport classNames from 'classnames';\nimport { bound } from '../../utils/bound';\nimport { usePropsValue } from '../../utils/use-props-value';\nconst classPrefix = 'adm-passcode-input';\nconst defaultProps = {\n  defaultValue: '',\n  length: 6,\n  plain: false,\n  error: false,\n  seperated: false,\n  caret: true\n};\nexport const PasscodeInput = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p); // 防止 length 值不合法\n\n  const cellLength = props.length > 0 && props.length < Infinity ? Math.floor(props.length) : defaultProps.length;\n  const [focused, setFocused] = useState(false);\n  const [value, setValue] = usePropsValue(props);\n  const rootRef = useRef(null);\n  const nativeInputRef = useRef(null);\n  useEffect(() => {\n    var _a;\n\n    if (value.length >= cellLength) {\n      (_a = props.onFill) === null || _a === void 0 ? void 0 : _a.call(props, value);\n    }\n  }, [value, cellLength]);\n\n  const onFocus = () => {\n    var _a, _b;\n\n    if (!props.keyboard) {\n      (_a = nativeInputRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n    }\n\n    setFocused(true);\n    (_b = props.onFocus) === null || _b === void 0 ? void 0 : _b.call(props);\n  };\n\n  useEffect(() => {\n    if (!focused) return;\n    const timeout = window.setTimeout(() => {\n      var _a;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.scrollIntoView({\n        block: 'center',\n        inline: 'center',\n        behavior: 'smooth'\n      });\n    }, 100);\n    return () => {\n      window.clearTimeout(timeout);\n    };\n  }, [focused]);\n\n  const onBlur = () => {\n    var _a;\n\n    setFocused(false);\n    (_a = props.onBlur) === null || _a === void 0 ? void 0 : _a.call(props);\n  };\n\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      var _a;\n\n      return (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n    },\n    blur: () => {\n      var _a, _b;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.blur();\n      (_b = nativeInputRef.current) === null || _b === void 0 ? void 0 : _b.blur();\n    }\n  }));\n\n  const renderCells = () => {\n    const cells = [];\n    const chars = value.split('');\n    const caretIndex = chars.length; // 光标位置index等于当前文字长度\n\n    const focusedIndex = bound(chars.length, 0, cellLength - 1);\n\n    for (let i = 0; i < cellLength; i++) {\n      cells.push(React.createElement(\"div\", {\n        className: classNames(`${classPrefix}-cell`, {\n          caret: props.caret && caretIndex === i && focused,\n          focused: focusedIndex === i && focused,\n          dot: !props.plain && chars[i]\n        }),\n        key: i\n      }, chars[i] && props.plain ? chars[i] : ''));\n    }\n\n    return cells;\n  };\n\n  const cls = classNames(classPrefix, {\n    focused: focused,\n    error: props.error,\n    seperated: props.seperated\n  });\n  return React.createElement(React.Fragment, null, withNativeProps(props, React.createElement(\"div\", {\n    ref: rootRef,\n    tabIndex: 0,\n    className: cls,\n    onFocus: onFocus,\n    onBlur: onBlur\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-cell-container`\n  }, renderCells()), React.createElement(\"input\", {\n    ref: nativeInputRef,\n    className: `${classPrefix}-native-input`,\n    value: value,\n    type: 'text',\n    pattern: '[0-9]*',\n    inputMode: 'numeric',\n    onChange: e => {\n      setValue(e.target.value.slice(0, props.length));\n    }\n  }))), props.keyboard && React.cloneElement(props.keyboard, {\n    visible: focused,\n    onInput: v => {\n      if (value.length < cellLength) {\n        setValue((value + v).slice(0, props.length));\n      }\n    },\n    onDelete: () => {\n      setValue(value.slice(0, -1));\n    },\n    onClose: () => {\n      var _a;\n\n      (_a = rootRef.current) === null || _a === void 0 ? void 0 : _a.blur();\n    }\n  }));\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}