{"ast":null,"code":"import React, { forwardRef, useRef, useState, useImperativeHandle } from 'react';\nimport classNames from 'classnames';\nimport { withNativeProps } from '../../utils/native-props';\nimport { useThrottleFn } from 'ahooks';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { Sidebar } from './sidebar';\nimport { convertPx } from '../../utils/convert-px';\nimport { Panel } from './panel';\nimport { devWarning } from '../../utils/dev-log';\nimport { traverseReactNode } from '../../utils/traverse-react-node';\nconst classPrefix = `adm-index-bar`;\nconst defaultProps = {\n  sticky: true\n};\nexport const IndexBar = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p);\n  const titleHeight = convertPx(35);\n  const bodyRef = useRef(null);\n  const indexItems = [];\n  const panels = [];\n  traverseReactNode(props.children, child => {\n    var _a;\n\n    if (!React.isValidElement(child)) return;\n\n    if (child.type !== Panel) {\n      devWarning('IndexBar', 'The children of `IndexBar` must be `IndexBar.Panel` components.');\n      return;\n    }\n\n    indexItems.push({\n      index: child.props.index,\n      brief: (_a = child.props.brief) !== null && _a !== void 0 ? _a : child.props.index.charAt(0)\n    });\n    panels.push(withNativeProps(child.props, React.createElement(\"div\", {\n      key: child.props.index,\n      \"data-index\": child.props.index,\n      className: `${classPrefix}-anchor`\n    }, React.createElement(\"div\", {\n      className: `${classPrefix}-anchor-title`\n    }, child.props.title || child.props.index), child.props.children)));\n  });\n  const [activeIndex, setActiveIndex] = useState(() => {\n    const firstItem = indexItems[0];\n    return firstItem ? firstItem.index : null;\n  });\n  useImperativeHandle(ref, () => ({\n    scrollTo\n  }));\n\n  function scrollTo(index) {\n    const body = bodyRef.current;\n    if (!body) return;\n    const children = body.children;\n\n    for (let i = 0; i < children.length; i++) {\n      const panel = children.item(i);\n      if (!panel) continue;\n      const panelIndex = panel.dataset['index'];\n\n      if (panelIndex === index) {\n        body.scrollTop = panel.offsetTop;\n        setActiveIndex(index);\n        return;\n      }\n    }\n  }\n\n  const {\n    run: checkActiveIndex\n  } = useThrottleFn(() => {\n    const body = bodyRef.current;\n    if (!body) return;\n    const scrollTop = body.scrollTop;\n    const elements = body.getElementsByClassName(`${classPrefix}-anchor`);\n\n    for (let i = 0; i < elements.length; i++) {\n      const panel = elements.item(i);\n      if (!panel) continue;\n      const panelIndex = panel.dataset['index'];\n      if (!panelIndex) continue;\n\n      if (panel.offsetTop + panel.clientHeight - titleHeight > scrollTop) {\n        setActiveIndex(panelIndex);\n        return;\n      }\n    }\n  }, {\n    wait: 50,\n    trailing: true,\n    leading: true\n  });\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(`${classPrefix}`, {\n      [`${classPrefix}-sticky`]: props.sticky\n    })\n  }, React.createElement(Sidebar, {\n    indexItems: indexItems,\n    activeIndex: activeIndex,\n    onActive: index => {\n      scrollTo(index);\n    }\n  }), React.createElement(\"div\", {\n    className: `${classPrefix}-body`,\n    ref: bodyRef,\n    onScroll: checkActiveIndex\n  }, panels)));\n});","map":{"version":3,"names":["React","forwardRef","useRef","useState","useImperativeHandle","classNames","withNativeProps","useThrottleFn","mergeProps","Sidebar","convertPx","Panel","devWarning","traverseReactNode","classPrefix","defaultProps","sticky","IndexBar","p","ref","props","titleHeight","bodyRef","indexItems","panels","children","child","_a","isValidElement","type","push","index","brief","charAt","createElement","key","className","title","activeIndex","setActiveIndex","firstItem","scrollTo","body","current","i","length","panel","item","panelIndex","dataset","scrollTop","offsetTop","run","checkActiveIndex","elements","getElementsByClassName","clientHeight","wait","trailing","leading","onActive","onScroll"],"sources":["/Users/yinyahui/Desktop/weblearn/juejin/react-antd-yyy-zongzi/node_modules/_antd-mobile@5.12.6@antd-mobile/es/components/index-bar/index-bar.js"],"sourcesContent":["import React, { forwardRef, useRef, useState, useImperativeHandle } from 'react';\nimport classNames from 'classnames';\nimport { withNativeProps } from '../../utils/native-props';\nimport { useThrottleFn } from 'ahooks';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { Sidebar } from './sidebar';\nimport { convertPx } from '../../utils/convert-px';\nimport { Panel } from './panel';\nimport { devWarning } from '../../utils/dev-log';\nimport { traverseReactNode } from '../../utils/traverse-react-node';\nconst classPrefix = `adm-index-bar`;\nconst defaultProps = {\n  sticky: true\n};\nexport const IndexBar = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p);\n  const titleHeight = convertPx(35);\n  const bodyRef = useRef(null);\n  const indexItems = [];\n  const panels = [];\n  traverseReactNode(props.children, child => {\n    var _a;\n\n    if (!React.isValidElement(child)) return;\n\n    if (child.type !== Panel) {\n      devWarning('IndexBar', 'The children of `IndexBar` must be `IndexBar.Panel` components.');\n      return;\n    }\n\n    indexItems.push({\n      index: child.props.index,\n      brief: (_a = child.props.brief) !== null && _a !== void 0 ? _a : child.props.index.charAt(0)\n    });\n    panels.push(withNativeProps(child.props, React.createElement(\"div\", {\n      key: child.props.index,\n      \"data-index\": child.props.index,\n      className: `${classPrefix}-anchor`\n    }, React.createElement(\"div\", {\n      className: `${classPrefix}-anchor-title`\n    }, child.props.title || child.props.index), child.props.children)));\n  });\n  const [activeIndex, setActiveIndex] = useState(() => {\n    const firstItem = indexItems[0];\n    return firstItem ? firstItem.index : null;\n  });\n  useImperativeHandle(ref, () => ({\n    scrollTo\n  }));\n\n  function scrollTo(index) {\n    const body = bodyRef.current;\n    if (!body) return;\n    const children = body.children;\n\n    for (let i = 0; i < children.length; i++) {\n      const panel = children.item(i);\n      if (!panel) continue;\n      const panelIndex = panel.dataset['index'];\n\n      if (panelIndex === index) {\n        body.scrollTop = panel.offsetTop;\n        setActiveIndex(index);\n        return;\n      }\n    }\n  }\n\n  const {\n    run: checkActiveIndex\n  } = useThrottleFn(() => {\n    const body = bodyRef.current;\n    if (!body) return;\n    const scrollTop = body.scrollTop;\n    const elements = body.getElementsByClassName(`${classPrefix}-anchor`);\n\n    for (let i = 0; i < elements.length; i++) {\n      const panel = elements.item(i);\n      if (!panel) continue;\n      const panelIndex = panel.dataset['index'];\n      if (!panelIndex) continue;\n\n      if (panel.offsetTop + panel.clientHeight - titleHeight > scrollTop) {\n        setActiveIndex(panelIndex);\n        return;\n      }\n    }\n  }, {\n    wait: 50,\n    trailing: true,\n    leading: true\n  });\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(`${classPrefix}`, {\n      [`${classPrefix}-sticky`]: props.sticky\n    })\n  }, React.createElement(Sidebar, {\n    indexItems: indexItems,\n    activeIndex: activeIndex,\n    onActive: index => {\n      scrollTo(index);\n    }\n  }), React.createElement(\"div\", {\n    className: `${classPrefix}-body`,\n    ref: bodyRef,\n    onScroll: checkActiveIndex\n  }, panels)));\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}