{"ast":null,"code":"import { useRef } from 'react';\nimport useUpdateEffect from '../../../useUpdateEffect';\nimport isDocumentVisible from '../utils/isDocumentVisible';\nimport subscribeReVisible from '../utils/subscribeReVisible';\n\nvar usePollingPlugin = function usePollingPlugin(fetchInstance, _a) {\n  var pollingInterval = _a.pollingInterval,\n      _b = _a.pollingWhenHidden,\n      pollingWhenHidden = _b === void 0 ? true : _b;\n  var timerRef = useRef();\n  var unsubscribeRef = useRef();\n\n  var stopPolling = function stopPolling() {\n    var _a;\n\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n    }\n\n    (_a = unsubscribeRef.current) === null || _a === void 0 ? void 0 : _a.call(unsubscribeRef);\n  };\n\n  useUpdateEffect(function () {\n    if (!pollingInterval) {\n      stopPolling();\n    }\n  }, [pollingInterval]);\n\n  if (!pollingInterval) {\n    return {};\n  }\n\n  return {\n    onBefore: function onBefore() {\n      stopPolling();\n    },\n    onFinally: function onFinally() {\n      // if pollingWhenHidden = false && document is hidden, then stop polling and subscribe revisible\n      if (!pollingWhenHidden && !isDocumentVisible()) {\n        unsubscribeRef.current = subscribeReVisible(function () {\n          fetchInstance.refresh();\n        });\n        return;\n      }\n\n      timerRef.current = setTimeout(function () {\n        fetchInstance.refresh();\n      }, pollingInterval);\n    },\n    onCancel: function onCancel() {\n      stopPolling();\n    }\n  };\n};\n\nexport default usePollingPlugin;","map":{"version":3,"names":["useRef","useUpdateEffect","isDocumentVisible","subscribeReVisible","usePollingPlugin","fetchInstance","_a","pollingInterval","_b","pollingWhenHidden","timerRef","unsubscribeRef","stopPolling","current","clearTimeout","call","onBefore","onFinally","refresh","setTimeout","onCancel"],"sources":["/Users/yinyahui/Desktop/weblearn/juejin/react-antd-yyy-zongzi/node_modules/_ahooks@3.4.0@ahooks/es/useRequest/src/plugins/usePollingPlugin.js"],"sourcesContent":["import { useRef } from 'react';\nimport useUpdateEffect from '../../../useUpdateEffect';\nimport isDocumentVisible from '../utils/isDocumentVisible';\nimport subscribeReVisible from '../utils/subscribeReVisible';\n\nvar usePollingPlugin = function usePollingPlugin(fetchInstance, _a) {\n  var pollingInterval = _a.pollingInterval,\n      _b = _a.pollingWhenHidden,\n      pollingWhenHidden = _b === void 0 ? true : _b;\n  var timerRef = useRef();\n  var unsubscribeRef = useRef();\n\n  var stopPolling = function stopPolling() {\n    var _a;\n\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n    }\n\n    (_a = unsubscribeRef.current) === null || _a === void 0 ? void 0 : _a.call(unsubscribeRef);\n  };\n\n  useUpdateEffect(function () {\n    if (!pollingInterval) {\n      stopPolling();\n    }\n  }, [pollingInterval]);\n\n  if (!pollingInterval) {\n    return {};\n  }\n\n  return {\n    onBefore: function onBefore() {\n      stopPolling();\n    },\n    onFinally: function onFinally() {\n      // if pollingWhenHidden = false && document is hidden, then stop polling and subscribe revisible\n      if (!pollingWhenHidden && !isDocumentVisible()) {\n        unsubscribeRef.current = subscribeReVisible(function () {\n          fetchInstance.refresh();\n        });\n        return;\n      }\n\n      timerRef.current = setTimeout(function () {\n        fetchInstance.refresh();\n      }, pollingInterval);\n    },\n    onCancel: function onCancel() {\n      stopPolling();\n    }\n  };\n};\n\nexport default usePollingPlugin;"],"mappings":"AAAA,SAASA,MAAT,QAAuB,OAAvB;AACA,OAAOC,eAAP,MAA4B,0BAA5B;AACA,OAAOC,iBAAP,MAA8B,4BAA9B;AACA,OAAOC,kBAAP,MAA+B,6BAA/B;;AAEA,IAAIC,gBAAgB,GAAG,SAASA,gBAAT,CAA0BC,aAA1B,EAAyCC,EAAzC,EAA6C;EAClE,IAAIC,eAAe,GAAGD,EAAE,CAACC,eAAzB;EAAA,IACIC,EAAE,GAAGF,EAAE,CAACG,iBADZ;EAAA,IAEIA,iBAAiB,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgB,IAAhB,GAAuBA,EAF/C;EAGA,IAAIE,QAAQ,GAAGV,MAAM,EAArB;EACA,IAAIW,cAAc,GAAGX,MAAM,EAA3B;;EAEA,IAAIY,WAAW,GAAG,SAASA,WAAT,GAAuB;IACvC,IAAIN,EAAJ;;IAEA,IAAII,QAAQ,CAACG,OAAb,EAAsB;MACpBC,YAAY,CAACJ,QAAQ,CAACG,OAAV,CAAZ;IACD;;IAED,CAACP,EAAE,GAAGK,cAAc,CAACE,OAArB,MAAkC,IAAlC,IAA0CP,EAAE,KAAK,KAAK,CAAtD,GAA0D,KAAK,CAA/D,GAAmEA,EAAE,CAACS,IAAH,CAAQJ,cAAR,CAAnE;EACD,CARD;;EAUAV,eAAe,CAAC,YAAY;IAC1B,IAAI,CAACM,eAAL,EAAsB;MACpBK,WAAW;IACZ;EACF,CAJc,EAIZ,CAACL,eAAD,CAJY,CAAf;;EAMA,IAAI,CAACA,eAAL,EAAsB;IACpB,OAAO,EAAP;EACD;;EAED,OAAO;IACLS,QAAQ,EAAE,SAASA,QAAT,GAAoB;MAC5BJ,WAAW;IACZ,CAHI;IAILK,SAAS,EAAE,SAASA,SAAT,GAAqB;MAC9B;MACA,IAAI,CAACR,iBAAD,IAAsB,CAACP,iBAAiB,EAA5C,EAAgD;QAC9CS,cAAc,CAACE,OAAf,GAAyBV,kBAAkB,CAAC,YAAY;UACtDE,aAAa,CAACa,OAAd;QACD,CAF0C,CAA3C;QAGA;MACD;;MAEDR,QAAQ,CAACG,OAAT,GAAmBM,UAAU,CAAC,YAAY;QACxCd,aAAa,CAACa,OAAd;MACD,CAF4B,EAE1BX,eAF0B,CAA7B;IAGD,CAhBI;IAiBLa,QAAQ,EAAE,SAASA,QAAT,GAAoB;MAC5BR,WAAW;IACZ;EAnBI,CAAP;AAqBD,CAhDD;;AAkDA,eAAeR,gBAAf"},"metadata":{},"sourceType":"module"}